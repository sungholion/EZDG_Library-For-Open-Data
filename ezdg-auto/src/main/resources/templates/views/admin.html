<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EZDG 관리자 페이지</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .custom-btn-width {
            width: 40%;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <section id="admin" th:data-is-success="${isSuccess}">
        <h2 class="text-center">EZDG 관리자 페이지</h2>

        <!-- 인증 폼 -->
        <form action="/admin/authenticate" method="post" id="authForm">
            <div class="text-center mb-4">
                <input
                        type="text"
                        name="code"
                        class="form-control d-inline-block w-25"
                        id="adminCodeInput"
                        placeholder="관리자 코드 입력"
                        required
                />
                <button type="submit" class="btn btn-primary" id="authButton">인증</button>
                <div class="form-text">※ 부여받은 관리자 코드를 입력하세요</div>
            </div>
        </form>

        <div class="text-center">
            <button
                    class="btn btn-primary custom-btn-width mb-3 d-block mx-auto"
                    onclick="navigateTo('/admin/file')"
            >
                파일
            </button>
            <button
                    class="btn btn-success custom-btn-width mb-3 d-block mx-auto"
                    onclick="navigateTo('/admin/openapi')"
            >
                Open API
            </button>
            <button
                    class="btn btn-primary custom-btn-width mb-3 d-block mx-auto"
                    onclick="navigateTo('/admin/data')"
            >
                데이터 신청 현황
            </button>
            <button
                    class="btn btn-success custom-btn-width d-block mx-auto"
                    onclick="navigateTo('/admin/deploy')"
            >
                배포 현황
            </button>
        </div>
    </section>
</div>

<!-- 인증 모달 -->
<div
        class="modal fade"
        id="authModal"
        tabindex="-1"
        aria-labelledby="authModalLabel"
        aria-hidden="true"
>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="authModalLabel">인증 결과</h5>
                <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                ></button>
            </div>
            <div class="modal-body" id="modalBody">관리자 코드가 올바른지 확인해주세요.</div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">확인</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
    let isAuth = document.getElementById("admin").getAttribute("data-is-success") === "true";
    function navigateTo(url) {
        if (isAuth) {
            window.location.href = url;
        } else {
            new bootstrap.Modal(document.getElementById("authModal")).show();
        }
    }

    window.onload = function () {
        const isSuccessAttr = document.getElementById("admin").getAttribute("data-is-success");

        // 인증 필드와 버튼 처리
        const adminCodeInput = document.getElementById("adminCodeInput");
        const authButton = document.getElementById("authButton");

        if (isSuccessAttr !== null) {
            const isSuccess = isSuccessAttr === "true";
            if (isSuccess) {
                // 인증이 완료된 경우: 입력 필드 읽기 전용 및 메시지 변경
                adminCodeInput.value = "관리자 인증이 완료되었습니다.";
                adminCodeInput.readOnly = true;
                authButton.disabled = true; // 인증 버튼 비활성화
            }
        }

        if (isSuccessAttr !== null) {
            const isSuccess = isSuccessAttr === "true";
            const modalBody = document.getElementById("modalBody");
            if (isSuccess) {
                modalBody.innerText = "인증이 완료되었습니다.";
            } else {
                modalBody.innerText = "관리자 코드가 올바른지 확인해주세요.";
            }
            new bootstrap.Modal(document.getElementById("authModal")).show();
        }
    };
</script>
</body>
</html>
